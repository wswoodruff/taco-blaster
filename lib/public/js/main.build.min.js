(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){"use strict";function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(undefined)})}}require("regenerator-runtime");var _require=require("./particles-on-click"),genParticles=_require.genParticles;console.log("TACOOOOOOOOOOOOOOOOOOOOS!!!");var DEBUG=false;var TACOS_ROOM_ID="tacos-n-friends";var MY_TACO_ID="my-taco";var USE_NES=true;var CURSOR_UPDATE_THROTTLE=10;var Throttle=require("lodash.throttle");var Nes;if(USE_NES){Nes=require("@hapi/nes/lib/client")}var RoomClient;var roomUserId=null;var roomX=0;var roomY=0;var isMouseDown=false;var abbreviateUserId=function abbreviateUserId(userId){return"...".concat(userId.split("-").pop())};var addIdToElIfNotExists=function addIdToElIfNotExists(el,id){var idEl=el.querySelector(".taco-id");if(!idEl){var tacoId=document.createElement("div");tacoId.className="taco-id";tacoId.textContent=abbreviateUserId(id);tacoId.style.color="white";tacoId.style.fontSize="16px";tacoId.style.position="absolute";tacoId.style.transform="translateX(-25%)";tacoId.style.bottom="-20px";tacoId.style.whiteSpace="nowrap";el.appendChild(tacoId)}};var updateRoom=function(){var _ref2=_asyncToGenerator(regeneratorRuntime.mark(function _callee(_ref){var roomId,userId,x,y,isMouseDown,payload,_yield$RoomClient$req,_yield$RoomClient$req2,error,user,myTacoEl,connectionMsg;return regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:roomId=_ref.roomId,userId=_ref.userId,x=_ref.x,y=_ref.y,isMouseDown=_ref.isMouseDown;payload={x:x,y:y,isMouseDown:isMouseDown};if(userId){payload.id=userId}_context.next=5;return RoomClient.request({method:"post",path:"/rooms/".concat(roomId,"/update"),payload:payload});case 5:_yield$RoomClient$req=_context.sent;_yield$RoomClient$req2=_yield$RoomClient$req.payload;error=_yield$RoomClient$req2.error;user=_yield$RoomClient$req2.user;if(user){roomUserId=user.id;myTacoEl=document.getElementById(MY_TACO_ID);addIdToElIfNotExists(myTacoEl,roomUserId)}connectionMsg=document.getElementById("connectionMsg")||document.createElement("h3");connectionMsg.id="connectionMsg";if(error){connectionMsg.style.color="#f88070";connectionMsg.textContent="Error ".concat(error.message||error)}else{connectionMsg.style.color="#73c991";connectionMsg.textContent="Connected x: ".concat(x||"null"," y: ").concat(y||"null")}document.body.appendChild(connectionMsg);return _context.abrupt("return",user);case 15:case"end":return _context.stop()}}},_callee)}));return function updateRoom(_x){return _ref2.apply(this,arguments)}}();var throttledBroadcast=Throttle(function(){updateRoom({roomId:TACOS_ROOM_ID,userId:roomUserId,x:roomX,y:roomY,isMouseDown:isMouseDown})},CURSOR_UPDATE_THROTTLE);window.addEventListener("mousedown",function(evt){isMouseDown=true;throttledBroadcast()});window.addEventListener("mouseup",function(evt){isMouseDown=false;throttledBroadcast()});var myTaco=document.getElementById(MY_TACO_ID);var moveCursor=function moveCursor(_ref3){var element=_ref3.element,x=_ref3.x,y=_ref3.y;element.style.left="".concat(x,"px");element.style.top="".concat(y,"px")};var initSocket=function(){var _ref4=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(){var _window,_window$location,protocol,host,url,wsLocation,connectionMsg,user,roomEl,clickTracker,roomUsers,onRoomUpdate;return regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!RoomClient){_context2.next=3;break}_context2.next=3;return RoomClient.disconnect();case 3:_window=window,_window$location=_window.location,protocol=_window$location.protocol,host=_window$location.host;url=protocol.replace("http","ws")+"//"+host;wsLocation=url.replace("localhost:3001","localhost:3000");console.log("wsLocation",wsLocation);RoomClient=new Nes.Client(wsLocation);_context2.prev=8;_context2.next=11;return RoomClient.connect();case 11:_context2.next=19;break;case 13:_context2.prev=13;_context2.t0=_context2["catch"](8);connectionMsg=document.getElementById("connectionMsg")||document.createElement("h3");connectionMsg.id="connectionMsg";connectionMsg.style.color="#f88070";connectionMsg.textContent="Error ".concat(_context2.t0.message);case 19:_context2.next=21;return updateRoom({roomId:TACOS_ROOM_ID,userId:roomUserId});case 21:user=_context2.sent;console.log("init user",user);roomEl=document.querySelector(".room");clickTracker={};roomUsers={};onRoomUpdate=function onRoomUpdate(props){var roomId=props.id,_props$users=props.users,users=_props$users===void 0?[]:_props$users,isSync=props.isSync,scoreboard=props.scoreboard;if(DEBUG){console.log("onRoomUpdate",props)}if(isSync){var scoreEl=document.getElementById("scoreboard");scoreEl.innerHTML="<h3>Scoreboard</h3>".concat(scoreboard.map(function(_ref5){var userId=_ref5.userId,score=_ref5.score;return"<p>".concat(abbreviateUserId(userId),": ").concat(score,"</p>")}).join(""));roomUsers=users}var usersNotMe=Object.keys(users).filter(function(id){return id!==roomUserId}).map(function(id){return users[id]});Object.values(usersNotMe).forEach(function(_ref6){var userId=_ref6.id,_ref6$lastClick=_ref6.lastClick;_ref6$lastClick=_ref6$lastClick===void 0?{}:_ref6$lastClick;var epoch=_ref6$lastClick.epoch,x=_ref6$lastClick.x,y=_ref6$lastClick.y;var userClicked=epoch;var lastUserClick=clickTracker[userId];var shouldGenParticles=false;if(userClicked&&!lastUserClick||lastUserClick&&userClicked>lastUserClick){shouldGenParticles=true}clickTracker[userId]=epoch;if(shouldGenParticles){genParticles(x,y)}clickTracker[userId]=epoch});var usersYesMe=users[Object.keys(users).find(function(id){return id===roomUserId})];var usersMarkedForDeletion=Object.values(usersNotMe).filter(function(_ref7){var shouldDelete=_ref7.shouldDelete;return!!shouldDelete}).map(function(_ref8){var id=_ref8.id;return id});var singleUsersNotMe=usersNotMe.length===1?usersNotMe[0]:null;if(DEBUG){if(usersYesMe){console.log("usersYesMe",usersYesMe)}if(singleUsersNotMe||usersNotMe.length){console.log("usersNotMe",singleUsersNotMe||usersNotMe)}}if(usersYesMe){moveCursor({element:myTaco,x:usersYesMe.x,y:usersYesMe.y})}var getIds=function getIds(arr){return arr.map(function(_ref9){var id=_ref9.id;return id})};var ghostTacos=Array.from(document.getElementsByClassName("ghost-taco"));var existingGhostIds=[];ghostTacos.forEach(function(tacoEl){var tacoExistsInUsers=Object.keys(roomUsers).includes(tacoEl.id);if(usersMarkedForDeletion.includes(tacoEl.id)||isSync&&!tacoExistsInUsers){roomEl.removeChild(tacoEl);return}existingGhostIds.push(tacoEl.id);var tacoUpdate=usersNotMe.find(function(_ref10){var id=_ref10.id;return id===tacoEl.id});if(tacoUpdate){moveCursor({element:tacoEl,x:tacoUpdate.x,y:tacoUpdate.y})}});var roomUserIds=Object.keys(roomUsers);var newGhostIds=getIds(usersNotMe).filter(function(id){return!roomUserIds.includes(id)});usersNotMe.forEach(function(user){roomUsers[user.id]=user});newGhostIds.forEach(function(id){var newTacoEl=document.createElement("div");newTacoEl.id=id;newTacoEl.classList.add("ghost-taco");newTacoEl.classList.add("taco-cursor");addIdToElIfNotExists(newTacoEl,id);roomEl.appendChild(newTacoEl);var userInfo=usersNotMe.find(function(_ref11){var id=_ref11.id;return id===id});moveCursor({element:newTacoEl,x:userInfo.x,y:userInfo.y});genParticles(userInfo.x,userInfo.y)})};_context2.next=29;return RoomClient.subscribe("/rooms/".concat(TACOS_ROOM_ID),onRoomUpdate);case 29:case"end":return _context2.stop()}}},_callee2,null,[[8,13]])}));return function initSocket(){return _ref4.apply(this,arguments)}}();var run=function run(){initSocket();var onMouseMove=function onMouseMove(evt){roomX=evt.pageX;roomY=evt.pageY;throttledBroadcast()};window.addEventListener("mousemove",onMouseMove);window.addEventListener("touchmove",function(evt){onMouseMove({pageX:Math.round(evt.changedTouches[0].clientX),pageY:Math.round(evt.changedTouches[0].clientY)})});document.body.addEventListener("click",function(evt){genParticles(evt.clientX,evt.clientY)})};run()},{"./particles-on-click":2,"@hapi/nes/lib/client":3,"lodash.throttle":4,"regenerator-runtime":5}],2:[function(require,module,exports){"use strict";var canvas=document.querySelector("#canvas");var ctx=canvas.getContext("2d");canvas.width=window.innerWidth;canvas.height=window.innerHeight;var config={particleNumber:30,maxParticleSize:20,maxSpeed:40,colorVariation:50};var colorPalette={bg:{r:0,g:0,b:0,a:0},matter:[{r:36,g:18,b:42},{r:78,g:36,b:42},{r:252,g:178,b:96},{r:253,g:238,b:152}]};var particles=[];var drawBg;var centerX=canvas.width/2;var centerY=canvas.height/2;drawBg=function drawBg(ctx,color){ctx.fillStyle="rgb("+color.r+","+color.g+","+color.b+")";ctx.fillRect(0,0,canvas.width,canvas.height)};var Particle=function Particle(x,y){this.x=x||Math.round(Math.random()*canvas.width);this.y=y||Math.round(Math.random()*canvas.height);this.r=Math.ceil(Math.random()*config.maxParticleSize);this.c=colorVariation(colorPalette.matter[Math.floor(Math.random()*colorPalette.matter.length)],true);this.s=Math.pow(Math.ceil(Math.random()*config.maxSpeed),.7);this.d=Math.round(Math.random()*360)};var colorVariation=function colorVariation(color,returnString){var r,g,b,a,variation;r=Math.round(Math.random()*config.colorVariation-config.colorVariation/2+color.r);g=Math.round(Math.random()*config.colorVariation-config.colorVariation/2+color.g);b=Math.round(Math.random()*config.colorVariation-config.colorVariation/2+color.b);a=Math.random()+.5;if(returnString){return"rgba("+r+","+g+","+b+","+a+")"}else{return{r:r,g:g,b:b,a:a}}};var updateParticleModel=function updateParticleModel(p){var a=180-(p.d+90);p.d>0&&p.d<180?p.x+=p.s*Math.sin(p.d)/Math.sin(p.s):p.x-=p.s*Math.sin(p.d)/Math.sin(p.s);p.d>90&&p.d<270?p.y+=p.s*Math.sin(a)/Math.sin(p.s):p.y-=p.s*Math.sin(a)/Math.sin(p.s);return p};var tacoImg=document.createElement("img");tacoImg.src="/public/taco.png";var drawParticle=function drawParticle(x,y,r,c){var size=r*2;ctx.globalCompositeOperation="source-over";ctx.drawImage(tacoImg,x,y,size,size)};var cleanUpArray=function cleanUpArray(){particles=particles.filter(function(p){return p.x>-100&&p.y>-100})};var initParticles=function initParticles(numParticles,x,y){for(var i=0;i<numParticles;i++){particles.push(new Particle(x,y))}particles.forEach(function(p){drawParticle(p.x,p.y,p.r,p.c)})};window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(callback){window.setTimeout(callback,1e3/60)}}();var frame=function frame(){drawBg(ctx,colorPalette.bg);particles.map(function(p){return updateParticleModel(p)});particles.forEach(function(p){drawParticle(p.x,p.y,p.r,p.c)});window.requestAnimFrame(frame)};frame();initParticles(config.particleNumber);exports.genParticles=function(x,y){cleanUpArray();initParticles(config.particleNumber,x,y)}},{}],3:[function(require,module,exports){(function(global){(function(){"use strict";(function(root,factory){if(typeof exports==="object"&&typeof module==="object"){module.exports=factory()}else if(typeof define==="function"&&define.amd){define(factory)}else if(typeof exports==="object"){exports.nes=factory()}else{root.nes=factory()}})(typeof window!=="undefined"?window:global,()=>{const version="2";const ignore=function(){};const stringify=function(message){try{return JSON.stringify(message)}catch(err){throw new NesError(err,errorTypes.USER)}};const nextTick=function(callback){return err=>{setTimeout(()=>callback(err),0)}};const errorTypes={TIMEOUT:"timeout",DISCONNECT:"disconnect",SERVER:"server",PROTOCOL:"protocol",WS:"ws",USER:"user"};const NesError=function(err,type){if(typeof err==="string"){err=new Error(err)}err.type=type;err.isNes=true;try{throw err}catch(withStack){return withStack}};const errorCodes={1e3:"Normal closure",1001:"Going away",1002:"Protocol error",1003:"Unsupported data",1004:"Reserved",1005:"No status received",1006:"Abnormal closure",1007:"Invalid frame payload data",1008:"Policy violation",1009:"Message too big",1010:"Mandatory extension",1011:"Internal server error",1015:"TLS handshake"};const Client=function(url,options){options=options||{};this._isBrowser=typeof WebSocket!=="undefined";if(!this._isBrowser){options.ws=options.ws||{};if(options.ws.maxPayload===undefined){options.ws.maxPayload=0}}this._url=url;this._settings=options;this._heartbeatTimeout=false;this._ws=null;this._reconnection=null;this._reconnectionTimer=null;this._ids=0;this._requests={};this._subscriptions={};this._heartbeat=null;this._packets=[];this._disconnectListeners=null;this._disconnectRequested=false;this.onError=err=>console.error(err);this.onConnect=ignore;this.onDisconnect=ignore;this.onHeartbeatTimeout=ignore;this.onUpdate=ignore;this.id=null};Client.WebSocket=typeof WebSocket==="undefined"?null:WebSocket;Client.prototype.connect=function(options){options=options||{};if(this._reconnection){return Promise.reject(new NesError("Cannot connect while client attempts to reconnect",errorTypes.USER))}if(this._ws){return Promise.reject(new NesError("Already connected",errorTypes.USER))}if(options.reconnect!==false){this._reconnection={wait:0,delay:options.delay||1e3,maxDelay:options.maxDelay||5e3,retries:options.retries||Infinity,settings:{auth:options.auth,timeout:options.timeout}}}else{this._reconnection=null}return new Promise((resolve,reject)=>{this._connect(options,true,err=>{if(err){return reject(err)}return resolve()})})};Client.prototype._connect=function(options,initial,next){const ws=this._isBrowser?new Client.WebSocket(this._url):new Client.WebSocket(this._url,this._settings.ws);this._ws=ws;clearTimeout(this._reconnectionTimer);this._reconnectionTimer=null;const reconnect=event=>{if(ws.onopen){finalize(new NesError("Connection terminated while waiting to connect",errorTypes.WS))}const wasRequested=this._disconnectRequested;this._cleanup();const log={code:event.code,explanation:errorCodes[event.code]||"Unknown",reason:event.reason,wasClean:event.wasClean,willReconnect:this._willReconnect(),wasRequested:wasRequested};this.onDisconnect(log.willReconnect,log);this._reconnect()};const finalize=err=>{if(next){const nextHolder=next;next=null;return nextHolder(err)}return this.onError(err)};const timeoutHandler=()=>{this._cleanup();finalize(new NesError("Connection timed out",errorTypes.TIMEOUT));if(initial){return this._reconnect()}};const timeout=options.timeout?setTimeout(timeoutHandler,options.timeout):null;ws.onopen=()=>{clearTimeout(timeout);ws.onopen=null;this._hello(options.auth).then(()=>{this.onConnect();finalize()}).catch(err=>{if(err.path){delete this._subscriptions[err.path]}this._disconnect(()=>nextTick(finalize)(err),true)})};ws.onerror=event=>{clearTimeout(timeout);if(this._willReconnect()){return reconnect(event)}this._cleanup();const error=new NesError("Socket error",errorTypes.WS);return finalize(error)};ws.onclose=reconnect;ws.onmessage=message=>{return this._onMessage(message)}};Client.prototype.overrideReconnectionAuth=function(auth){if(!this._reconnection){return false}this._reconnection.settings.auth=auth;return true};Client.prototype.reauthenticate=function(auth){this.overrideReconnectionAuth(auth);const request={type:"reauth",auth:auth};return this._send(request,true)};Client.prototype.disconnect=function(){return new Promise(resolve=>this._disconnect(resolve,false))};Client.prototype._disconnect=function(next,isInternal){this._reconnection=null;clearTimeout(this._reconnectionTimer);this._reconnectionTimer=null;const requested=this._disconnectRequested||!isInternal;if(this._disconnectListeners){this._disconnectRequested=requested;this._disconnectListeners.push(next);return}if(!this._ws||this._ws.readyState!==Client.WebSocket.OPEN&&this._ws.readyState!==Client.WebSocket.CONNECTING){return next()}this._disconnectRequested=requested;this._disconnectListeners=[next];this._ws.close()};Client.prototype._cleanup=function(){if(this._ws){const ws=this._ws;this._ws=null;if(ws.readyState!==Client.WebSocket.CLOSED&&ws.readyState!==Client.WebSocket.CLOSING){ws.close()}ws.onopen=null;ws.onclose=null;ws.onerror=ignore;ws.onmessage=null}this._packets=[];this.id=null;clearTimeout(this._heartbeat);this._heartbeat=null;const error=new NesError("Request failed - server disconnected",errorTypes.DISCONNECT);const requests=this._requests;this._requests={};const ids=Object.keys(requests);for(let i=0;i<ids.length;++i){const id=ids[i];const request=requests[id];clearTimeout(request.timeout);request.reject(error)}if(this._disconnectListeners){const listeners=this._disconnectListeners;this._disconnectListeners=null;this._disconnectRequested=false;listeners.forEach(listener=>listener())}};Client.prototype._reconnect=function(){const reconnection=this._reconnection;if(!reconnection){return}if(reconnection.retries<1){return this._disconnect(ignore,true)}--reconnection.retries;reconnection.wait=reconnection.wait+reconnection.delay;const timeout=Math.min(reconnection.wait,reconnection.maxDelay);this._reconnectionTimer=setTimeout(()=>{this._connect(reconnection.settings,false,err=>{if(err){this.onError(err);return this._reconnect()}})},timeout)};Client.prototype.request=function(options){if(typeof options==="string"){options={method:"GET",path:options}}const request={type:"request",method:options.method||"GET",path:options.path,headers:options.headers,payload:options.payload};return this._send(request,true)};Client.prototype.message=function(message){const request={type:"message",message:message};return this._send(request,true)};Client.prototype._isReady=function(){return this._ws&&this._ws.readyState===Client.WebSocket.OPEN};Client.prototype._send=function(request,track){if(!this._isReady()){return Promise.reject(new NesError("Failed to send message - server disconnected",errorTypes.DISCONNECT))}request.id=++this._ids;try{var encoded=stringify(request)}catch(err){return Promise.reject(err)}if(!track){try{this._ws.send(encoded);return Promise.resolve()}catch(err){return Promise.reject(new NesError(err,errorTypes.WS))}}const record={resolve:null,reject:null,timeout:null};const promise=new Promise((resolve,reject)=>{record.resolve=resolve;record.reject=reject});if(this._settings.timeout){record.timeout=setTimeout(()=>{record.timeout=null;return record.reject(new NesError("Request timed out",errorTypes.TIMEOUT))},this._settings.timeout)}this._requests[request.id]=record;try{this._ws.send(encoded)}catch(err){clearTimeout(this._requests[request.id].timeout);delete this._requests[request.id];return Promise.reject(new NesError(err,errorTypes.WS))}return promise};Client.prototype._hello=function(auth){const request={type:"hello",version:version};if(auth){request.auth=auth}const subs=this.subscriptions();if(subs.length){request.subs=subs}return this._send(request,true)};Client.prototype.subscriptions=function(){return Object.keys(this._subscriptions)};Client.prototype.subscribe=function(path,handler){if(!path||path[0]!=="/"){return Promise.reject(new NesError("Invalid path",errorTypes.USER))}const subs=this._subscriptions[path];if(subs){if(subs.indexOf(handler)===-1){subs.push(handler)}return Promise.resolve()}this._subscriptions[path]=[handler];if(!this._isReady()){return Promise.resolve()}const request={type:"sub",path:path};const promise=this._send(request,true);promise.catch(ignoreErr=>{delete this._subscriptions[path]});return promise};Client.prototype.unsubscribe=function(path,handler){if(!path||path[0]!=="/"){return Promise.reject(new NesError("Invalid path",errorTypes.USER))}const subs=this._subscriptions[path];if(!subs){return Promise.resolve()}let sync=false;if(!handler){delete this._subscriptions[path];sync=true}else{const pos=subs.indexOf(handler);if(pos===-1){return Promise.resolve()}subs.splice(pos,1);if(!subs.length){delete this._subscriptions[path];sync=true}}if(!sync||!this._isReady()){return Promise.resolve()}const request={type:"unsub",path:path};const promise=this._send(request,true);promise.catch(ignore);return promise};Client.prototype._onMessage=function(message){this._beat();let data=message.data;const prefix=data[0];if(prefix!=="{"){this._packets.push(data.slice(1));if(prefix!=="!"){return}data=this._packets.join("");this._packets=[]}if(this._packets.length){this._packets=[];this.onError(new NesError("Received an incomplete message",errorTypes.PROTOCOL))}try{var update=JSON.parse(data)}catch(err){return this.onError(new NesError(err,errorTypes.PROTOCOL))}let error=null;if(update.statusCode&&update.statusCode>=400){error=new NesError(update.payload.message||update.payload.error||"Error",errorTypes.SERVER);error.statusCode=update.statusCode;error.data=update.payload;error.headers=update.headers;error.path=update.path}if(update.type==="ping"){return this._send({type:"ping"},false).catch(ignore)}if(update.type==="update"){return this.onUpdate(update.message)}if(update.type==="pub"||update.type==="revoke"){const handlers=this._subscriptions[update.path];if(update.type==="revoke"){delete this._subscriptions[update.path]}if(handlers&&update.message!==undefined){const flags={};if(update.type==="revoke"){flags.revoked=true}for(let i=0;i<handlers.length;++i){handlers[i](update.message,flags)}}return}const request=this._requests[update.id];if(!request){return this.onError(new NesError("Received response for unknown request",errorTypes.PROTOCOL))}clearTimeout(request.timeout);delete this._requests[update.id];const next=(err,args)=>{if(err){return request.reject(err)}return request.resolve(args)};if(update.type==="request"){return next(error,{payload:update.payload,statusCode:update.statusCode,headers:update.headers})}if(update.type==="message"){return next(error,{payload:update.message})}if(update.type==="hello"){this.id=update.socket;if(update.heartbeat){this._heartbeatTimeout=update.heartbeat.interval+update.heartbeat.timeout;this._beat()}return next(error)}if(update.type==="reauth"){return next(error,true)}if(update.type==="sub"||update.type==="unsub"){return next(error)}next(new NesError("Received invalid response",errorTypes.PROTOCOL));return this.onError(new NesError("Received unknown response type: "+update.type,errorTypes.PROTOCOL))};Client.prototype._beat=function(){if(!this._heartbeatTimeout){return}clearTimeout(this._heartbeat);this._heartbeat=setTimeout(()=>{this.onError(new NesError("Disconnecting due to heartbeat timeout",errorTypes.TIMEOUT));this.onHeartbeatTimeout(this._willReconnect());this._ws.close()},this._heartbeatTimeout)};Client.prototype._willReconnect=function(){return!!(this._reconnection&&this._reconnection.retries>=1)};return{Client:Client}})}).call(this)}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],4:[function(require,module,exports){(function(global){(function(){var FUNC_ERROR_TEXT="Expected a function";var NAN=0/0;var symbolTag="[object Symbol]";var reTrim=/^\s+|\s+$/g;var reIsBadHex=/^[-+]0x[0-9a-f]+$/i;var reIsBinary=/^0b[01]+$/i;var reIsOctal=/^0o[0-7]+$/i;var freeParseInt=parseInt;var freeGlobal=typeof global=="object"&&global&&global.Object===Object&&global;var freeSelf=typeof self=="object"&&self&&self.Object===Object&&self;var root=freeGlobal||freeSelf||Function("return this")();var objectProto=Object.prototype;var objectToString=objectProto.toString;var nativeMax=Math.max,nativeMin=Math.min;var now=function(){return root.Date.now()};function debounce(func,wait,options){var lastArgs,lastThis,maxWait,result,timerId,lastCallTime,lastInvokeTime=0,leading=false,maxing=false,trailing=true;if(typeof func!="function"){throw new TypeError(FUNC_ERROR_TEXT)}wait=toNumber(wait)||0;if(isObject(options)){leading=!!options.leading;maxing="maxWait"in options;maxWait=maxing?nativeMax(toNumber(options.maxWait)||0,wait):maxWait;trailing="trailing"in options?!!options.trailing:trailing}function invokeFunc(time){var args=lastArgs,thisArg=lastThis;lastArgs=lastThis=undefined;lastInvokeTime=time;result=func.apply(thisArg,args);return result}function leadingEdge(time){lastInvokeTime=time;timerId=setTimeout(timerExpired,wait);return leading?invokeFunc(time):result}function remainingWait(time){var timeSinceLastCall=time-lastCallTime,timeSinceLastInvoke=time-lastInvokeTime,result=wait-timeSinceLastCall;return maxing?nativeMin(result,maxWait-timeSinceLastInvoke):result}function shouldInvoke(time){var timeSinceLastCall=time-lastCallTime,timeSinceLastInvoke=time-lastInvokeTime;return lastCallTime===undefined||timeSinceLastCall>=wait||timeSinceLastCall<0||maxing&&timeSinceLastInvoke>=maxWait}function timerExpired(){var time=now();if(shouldInvoke(time)){return trailingEdge(time)}timerId=setTimeout(timerExpired,remainingWait(time))}function trailingEdge(time){timerId=undefined;if(trailing&&lastArgs){return invokeFunc(time)}lastArgs=lastThis=undefined;return result}function cancel(){if(timerId!==undefined){clearTimeout(timerId)}lastInvokeTime=0;lastArgs=lastCallTime=lastThis=timerId=undefined}function flush(){return timerId===undefined?result:trailingEdge(now())}function debounced(){var time=now(),isInvoking=shouldInvoke(time);lastArgs=arguments;lastThis=this;lastCallTime=time;if(isInvoking){if(timerId===undefined){return leadingEdge(lastCallTime)}if(maxing){timerId=setTimeout(timerExpired,wait);return invokeFunc(lastCallTime)}}if(timerId===undefined){timerId=setTimeout(timerExpired,wait)}return result}debounced.cancel=cancel;debounced.flush=flush;return debounced}function throttle(func,wait,options){var leading=true,trailing=true;if(typeof func!="function"){throw new TypeError(FUNC_ERROR_TEXT)}if(isObject(options)){leading="leading"in options?!!options.leading:leading;trailing="trailing"in options?!!options.trailing:trailing}return debounce(func,wait,{leading:leading,maxWait:wait,trailing:trailing})}function isObject(value){var type=typeof value;return!!value&&(type=="object"||type=="function")}function isObjectLike(value){return!!value&&typeof value=="object"}function isSymbol(value){return typeof value=="symbol"||isObjectLike(value)&&objectToString.call(value)==symbolTag}function toNumber(value){if(typeof value=="number"){return value}if(isSymbol(value)){return NAN}if(isObject(value)){var other=typeof value.valueOf=="function"?value.valueOf():value;value=isObject(other)?other+"":other}if(typeof value!="string"){return value===0?value:+value}value=value.replace(reTrim,"");var isBinary=reIsBinary.test(value);return isBinary||reIsOctal.test(value)?freeParseInt(value.slice(2),isBinary?2:8):reIsBadHex.test(value)?NAN:+value}module.exports=throttle}).call(this)}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],5:[function(require,module,exports){var runtime=function(exports){"use strict";var Op=Object.prototype;var hasOwn=Op.hasOwnProperty;var undefined;var $Symbol=typeof Symbol==="function"?Symbol:{};var iteratorSymbol=$Symbol.iterator||"@@iterator";var asyncIteratorSymbol=$Symbol.asyncIterator||"@@asyncIterator";var toStringTagSymbol=$Symbol.toStringTag||"@@toStringTag";function define(obj,key,value){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});return obj[key]}try{define({},"")}catch(err){define=function(obj,key,value){return obj[key]=value}}function wrap(innerFn,outerFn,self,tryLocsList){var protoGenerator=outerFn&&outerFn.prototype instanceof Generator?outerFn:Generator;var generator=Object.create(protoGenerator.prototype);var context=new Context(tryLocsList||[]);generator._invoke=makeInvokeMethod(innerFn,self,context);return generator}exports.wrap=wrap;function tryCatch(fn,obj,arg){try{return{type:"normal",arg:fn.call(obj,arg)}}catch(err){return{type:"throw",arg:err}}}var GenStateSuspendedStart="suspendedStart";var GenStateSuspendedYield="suspendedYield";var GenStateExecuting="executing";var GenStateCompleted="completed";var ContinueSentinel={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var IteratorPrototype={};define(IteratorPrototype,iteratorSymbol,function(){return this});var getProto=Object.getPrototypeOf;var NativeIteratorPrototype=getProto&&getProto(getProto(values([])));if(NativeIteratorPrototype&&NativeIteratorPrototype!==Op&&hasOwn.call(NativeIteratorPrototype,iteratorSymbol)){IteratorPrototype=NativeIteratorPrototype}var Gp=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(IteratorPrototype);GeneratorFunction.prototype=GeneratorFunctionPrototype;define(Gp,"constructor",GeneratorFunctionPrototype);define(GeneratorFunctionPrototype,"constructor",GeneratorFunction);GeneratorFunction.displayName=define(GeneratorFunctionPrototype,toStringTagSymbol,"GeneratorFunction");function defineIteratorMethods(prototype){["next","throw","return"].forEach(function(method){define(prototype,method,function(arg){return this._invoke(method,arg)})})}exports.isGeneratorFunction=function(genFun){var ctor=typeof genFun==="function"&&genFun.constructor;return ctor?ctor===GeneratorFunction||(ctor.displayName||ctor.name)==="GeneratorFunction":false};exports.mark=function(genFun){if(Object.setPrototypeOf){Object.setPrototypeOf(genFun,GeneratorFunctionPrototype)}else{genFun.__proto__=GeneratorFunctionPrototype;define(genFun,toStringTagSymbol,"GeneratorFunction")}genFun.prototype=Object.create(Gp);return genFun};exports.awrap=function(arg){return{__await:arg}};function AsyncIterator(generator,PromiseImpl){function invoke(method,arg,resolve,reject){var record=tryCatch(generator[method],generator,arg);if(record.type==="throw"){reject(record.arg)}else{var result=record.arg;var value=result.value;if(value&&typeof value==="object"&&hasOwn.call(value,"__await")){return PromiseImpl.resolve(value.__await).then(function(value){invoke("next",value,resolve,reject)},function(err){invoke("throw",err,resolve,reject)})}return PromiseImpl.resolve(value).then(function(unwrapped){result.value=unwrapped;resolve(result)},function(error){return invoke("throw",error,resolve,reject)})}}var previousPromise;function enqueue(method,arg){function callInvokeWithMethodAndArg(){return new PromiseImpl(function(resolve,reject){invoke(method,arg,resolve,reject)})}return previousPromise=previousPromise?previousPromise.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}this._invoke=enqueue}defineIteratorMethods(AsyncIterator.prototype);define(AsyncIterator.prototype,asyncIteratorSymbol,function(){return this});exports.AsyncIterator=AsyncIterator;exports.async=function(innerFn,outerFn,self,tryLocsList,PromiseImpl){if(PromiseImpl===void 0)PromiseImpl=Promise;var iter=new AsyncIterator(wrap(innerFn,outerFn,self,tryLocsList),PromiseImpl);return exports.isGeneratorFunction(outerFn)?iter:iter.next().then(function(result){return result.done?result.value:iter.next()})};function makeInvokeMethod(innerFn,self,context){var state=GenStateSuspendedStart;return function invoke(method,arg){if(state===GenStateExecuting){throw new Error("Generator is already running")}if(state===GenStateCompleted){if(method==="throw"){throw arg}return doneResult()}context.method=method;context.arg=arg;while(true){var delegate=context.delegate;if(delegate){var delegateResult=maybeInvokeDelegate(delegate,context);if(delegateResult){if(delegateResult===ContinueSentinel)continue;return delegateResult}}if(context.method==="next"){context.sent=context._sent=context.arg}else if(context.method==="throw"){if(state===GenStateSuspendedStart){state=GenStateCompleted;throw context.arg}context.dispatchException(context.arg)}else if(context.method==="return"){context.abrupt("return",context.arg)}state=GenStateExecuting;var record=tryCatch(innerFn,self,context);if(record.type==="normal"){state=context.done?GenStateCompleted:GenStateSuspendedYield;if(record.arg===ContinueSentinel){continue}return{value:record.arg,done:context.done}}else if(record.type==="throw"){state=GenStateCompleted;context.method="throw";context.arg=record.arg}}}}function maybeInvokeDelegate(delegate,context){var method=delegate.iterator[context.method];if(method===undefined){context.delegate=null;if(context.method==="throw"){if(delegate.iterator["return"]){context.method="return";context.arg=undefined;maybeInvokeDelegate(delegate,context);if(context.method==="throw"){return ContinueSentinel}}context.method="throw";context.arg=new TypeError("The iterator does not provide a 'throw' method")}return ContinueSentinel}var record=tryCatch(method,delegate.iterator,context.arg);if(record.type==="throw"){context.method="throw";context.arg=record.arg;context.delegate=null;return ContinueSentinel}var info=record.arg;if(!info){context.method="throw";context.arg=new TypeError("iterator result is not an object");context.delegate=null;return ContinueSentinel}if(info.done){context[delegate.resultName]=info.value;context.next=delegate.nextLoc;if(context.method!=="return"){context.method="next";context.arg=undefined}}else{return info}context.delegate=null;return ContinueSentinel}defineIteratorMethods(Gp);define(Gp,toStringTagSymbol,"Generator");define(Gp,iteratorSymbol,function(){return this});define(Gp,"toString",function(){return"[object Generator]"});function pushTryEntry(locs){var entry={tryLoc:locs[0]};if(1 in locs){entry.catchLoc=locs[1]}if(2 in locs){entry.finallyLoc=locs[2];entry.afterLoc=locs[3]}this.tryEntries.push(entry)}function resetTryEntry(entry){var record=entry.completion||{};record.type="normal";delete record.arg;entry.completion=record}function Context(tryLocsList){this.tryEntries=[{tryLoc:"root"}];tryLocsList.forEach(pushTryEntry,this);this.reset(true)}exports.keys=function(object){var keys=[];for(var key in object){keys.push(key)}keys.reverse();return function next(){while(keys.length){var key=keys.pop();if(key in object){next.value=key;next.done=false;return next}}next.done=true;return next}};function values(iterable){if(iterable){var iteratorMethod=iterable[iteratorSymbol];if(iteratorMethod){return iteratorMethod.call(iterable)}if(typeof iterable.next==="function"){return iterable}if(!isNaN(iterable.length)){var i=-1,next=function next(){while(++i<iterable.length){if(hasOwn.call(iterable,i)){next.value=iterable[i];next.done=false;return next}}next.value=undefined;next.done=true;return next};return next.next=next}}return{next:doneResult}}exports.values=values;function doneResult(){return{value:undefined,done:true}}Context.prototype={constructor:Context,reset:function(skipTempReset){this.prev=0;this.next=0;this.sent=this._sent=undefined;this.done=false;this.delegate=null;this.method="next";this.arg=undefined;this.tryEntries.forEach(resetTryEntry);if(!skipTempReset){for(var name in this){if(name.charAt(0)==="t"&&hasOwn.call(this,name)&&!isNaN(+name.slice(1))){this[name]=undefined}}}},stop:function(){this.done=true;var rootEntry=this.tryEntries[0];var rootRecord=rootEntry.completion;if(rootRecord.type==="throw"){throw rootRecord.arg}return this.rval},dispatchException:function(exception){if(this.done){throw exception}var context=this;function handle(loc,caught){record.type="throw";record.arg=exception;context.next=loc;if(caught){context.method="next";context.arg=undefined}return!!caught}for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];var record=entry.completion;if(entry.tryLoc==="root"){return handle("end")}if(entry.tryLoc<=this.prev){var hasCatch=hasOwn.call(entry,"catchLoc");var hasFinally=hasOwn.call(entry,"finallyLoc");if(hasCatch&&hasFinally){if(this.prev<entry.catchLoc){return handle(entry.catchLoc,true)}else if(this.prev<entry.finallyLoc){return handle(entry.finallyLoc)}}else if(hasCatch){if(this.prev<entry.catchLoc){return handle(entry.catchLoc,true)}}else if(hasFinally){if(this.prev<entry.finallyLoc){return handle(entry.finallyLoc)}}else{throw new Error("try statement without catch or finally")}}}},abrupt:function(type,arg){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.tryLoc<=this.prev&&hasOwn.call(entry,"finallyLoc")&&this.prev<entry.finallyLoc){var finallyEntry=entry;break}}if(finallyEntry&&(type==="break"||type==="continue")&&finallyEntry.tryLoc<=arg&&arg<=finallyEntry.finallyLoc){finallyEntry=null}var record=finallyEntry?finallyEntry.completion:{};record.type=type;record.arg=arg;if(finallyEntry){this.method="next";this.next=finallyEntry.finallyLoc;return ContinueSentinel}return this.complete(record)},complete:function(record,afterLoc){if(record.type==="throw"){throw record.arg}if(record.type==="break"||record.type==="continue"){this.next=record.arg}else if(record.type==="return"){this.rval=this.arg=record.arg;this.method="return";this.next="end"}else if(record.type==="normal"&&afterLoc){this.next=afterLoc}return ContinueSentinel},finish:function(finallyLoc){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.finallyLoc===finallyLoc){this.complete(entry.completion,entry.afterLoc);resetTryEntry(entry);return ContinueSentinel}}},catch:function(tryLoc){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.tryLoc===tryLoc){var record=entry.completion;if(record.type==="throw"){var thrown=record.arg;resetTryEntry(entry)}return thrown}}throw new Error("illegal catch attempt")},delegateYield:function(iterable,resultName,nextLoc){this.delegate={iterator:values(iterable),resultName:resultName,nextLoc:nextLoc};if(this.method==="next"){this.arg=undefined}return ContinueSentinel}};return exports}(typeof module==="object"?module.exports:{});try{regeneratorRuntime=runtime}catch(accidentalStrictMode){if(typeof globalThis==="object"){globalThis.regeneratorRuntime=runtime}else{Function("r","regeneratorRuntime = r")(runtime)}}},{}]},{},[1]);